<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calcular el stop Loss</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f7;
      color: #1d1d1f;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background-color: white;
      border-radius: 18px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
      font-size: 32px;
      font-weight: 600;
      margin-bottom: 18px;
      color: #1d1d1f;
    }
    p, pre {
      font-size: 15px;
      line-height: 1.6;
      color: #1d1d1f;
      margin-bottom: 18px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .controls {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .btn {
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      font-size: 15px;
      cursor: pointer;
      transition: background-color 0.15s ease, transform 0.05s ease;
    }
    .btn:active { transform: translateY(1px); }

    .btn-primary {
      background-color: #0a84ff;
      color: white;
    }
    .btn-primary:disabled {
      background-color: #7fb6ff;
      cursor: default;
    }

    .btn-secondary {
      background-color: #1d1d1f;
      color: white;
    }
    .btn-secondary:disabled {
      background-color: #8b8b90;
      cursor: default;
    }

    .form {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
      margin: 14px 0 18px;
    }
    @media (max-width: 820px) {
      .form { grid-template-columns: 1fr; }
    }
    label {
      font-size: 13px;
      color: #3a3a3c;
      display: block;
      margin-bottom: 6px;
    }
    input, select {
      width: 70%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #d2d2d7;
      background: #fff;
      font-size: 15px;
      outline: none;
    }
    input:focus, select:focus {
      border-color: #0a84ff;
      box-shadow: 0 0 0 3px rgba(10,132,255,0.15);
    }

    .hint {
      font-size: 13px;
      color: #6e6e73;
      margin-top: -6px;
      margin-bottom: 10px;
    }
    .error {
      background: #fff2f2;
      border: 1px solid #ffd0d0;
      color: #b42318;
      padding: 10px 12px;
      border-radius: 12px;
      margin-bottom: 12px;
      display: none;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      white-space: nowrap;
      border: 0;
    }

    .output {
      background: #f5f5f7;
      border-radius: 16px;
      padding: 16px;
      border: 1px solid #e5e5ea;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Calcular el stop Loss</h1>





    <div id="errorBox" class="error" aria-live="polite"></div>

    <div class="controls" aria-live="polite">


      <button id="copyBtn" class="btn btn-primary" type="button" aria-describedby="copyDesc" disabled>
        Copiar prompt
      </button>
      <span id="copyDesc" class="sr-only">Copia el prompt generado al portapapeles</span>
    </div>

    <div class="output" style="margin-top: 14px;">
      <pre id="descripcion">Completa los 3 campos y pulsa ‚ÄúGenerar prompt‚Äù.</pre>
    </div>
  </div>

  <script>
    (function () {
      const out = document.getElementById("descripcion");
      const btnCopy = document.getElementById("copyBtn");
      const btnGen = document.getElementById("genBtn");
      const err = document.getElementById("errorBox");

      const template = `Rol
Act√∫a como un Analista T√©cnico Senior Institucional, especializado en acciones y ETFs, con enfoque en:
estructura de mercado (price action)
volatilidad real (ATR)
gesti√≥n de riesgo profesional
preservaci√≥n de capital y seguimiento de tendencia
Tu objetivo es proteger estructura, evitar ruido y estandarizar decisiones para gesti√≥n de portafolio.

üîß Par√°metros de entrada (√öNICOS)
Ticker: (uno solo o lista de tickers)
Riesgo: (Bajo / Medio / Alto)
Horizonte: (Intrad√≠a / Swing / Buy & Hold)
‚ö†Ô∏è Tomar siempre el precio actual de mercado
 ‚ùå No solicitar ni usar precio de entrada para definir el stop t√©cnico inicial

üß† Decisiones internas del analista (NO preguntar al usuario)
1Ô∏è‚É£ Identificar autom√°ticamente:
si el activo es Acci√≥n o ETF
2Ô∏è‚É£ Clasificar el activo:
Acciones ‚Üí Mega / Large / Mid / Small Cap
ETFs ‚Üí √çndice / Sectorial / Factor / Geogr√°fico / Bonos / Commodities
3Ô∏è‚É£ Evaluar:
volatilidad estructural
liquidez
comportamiento t√≠pico
4Ô∏è‚É£ Seleccionar autom√°ticamente:
timeframes principal y de confirmaci√≥n
tipo de stop (t√©cnico o trailing)
m√©todo de trailing m√°s adecuado

üéØ Contexto operativo seg√∫n horizonte
üîπ Intrad√≠a
Timeframes: 5m / 15m (confirmaci√≥n 1H)
Stops ajustados pero fuera del ruido intrad√≠a
Alta frecuencia de actualizaci√≥n
üîπ Swing
Timeframes: Diario (confirmaci√≥n 4H)
Horizonte: 1‚Äì3 semanas
Balance entre protecci√≥n y upside
üîπ Buy & Hold
Timeframes: Semanal (confirmaci√≥n Diario)
Horizonte: meses a a√±os
Prioridad absoluta a tendencia primaria

üß© Instrucciones de an√°lisis (OBLIGATORIAS)
1Ô∏è‚É£ Contexto de mercado
Tendencia primaria y secundaria
Fase del mercado:
impulso
pullback
consolidaci√≥n
distribuci√≥n

2Ô∏è‚É£ Estructura t√©cnica (PRIORIDAD M√ÅXIMA)
M√°ximos y m√≠nimos relevantes
Soportes estructurales (HTF en Buy & Hold)
Nivel exacto donde la tesis queda invalidada
üìå Prioridad del stop:
 Estructura > ATR > EMA

3Ô∏è‚É£ Indicadores (uso profesional)
EMA seg√∫n horizonte:
Intrad√≠a ‚Üí EMA 20 / 50
Swing ‚Üí EMA 20 / 50
Buy & Hold ‚Üí EMA 100 / 200
ATR(14) para dimensionar riesgo
RSI solo como contexto

4Ô∏è‚É£ Volatilidad y ruido
Volatilidad normal esperada (%)
Rango de ruido t√≠pico seg√∫n horizonte
Diferenciar:
ruido
retroceso sano
quiebre estructural

üõë Stop Loss y Trailing Stop ‚Äì Reglas autom√°ticas
üîπ Stop t√©cnico inicial (desde precio actual)
Acciones
Intrad√≠a ‚Üí 1.2‚Äì1.8x ATR
Swing ‚Üí 1.8‚Äì2.5x ATR
Buy & Hold ‚Üí 2.5‚Äì3.5x ATR
ETFs
Intrad√≠a ‚Üí ‚ùå Evitar (salvo ETFs muy l√≠quidos)
Swing ‚Üí 2.5‚Äì3.5x ATR
Buy & Hold ‚Üí 3‚Äì5x ATR

üîπ Control de retroceso seg√∫n riesgo
Riesgo
M√°x. retroceso permitido
Bajo
Muy conservador
Medio
Moderado
Alto
Amplio (estructura manda)

(Respetar siempre ATR y estructura)

üîπ Trailing Stop autom√°tico (OBLIGATORIO)
Selecci√≥n autom√°tica seg√∫n activo + horizonte
Intrad√≠a ‚Üí estructura + ATR
Swing ‚Üí EMA + ATR
Buy & Hold ‚Üí EMA HTF (100 / 200)
Reglas universales
Stop siempre por debajo de EMA
Ajustar solo con:
mejora estructural
cierre confirmado
‚ùå Nunca mover el stop por emoci√≥n o precio aislado

üì§ FORMATO DE SALIDA (OBLIGATORIO)
üìä Tabla comparativa para portafolio
Ticker
Tipo
Horizonte
Riesgo
Tendencia
Precio actual
Stop
% Stop
Tipo de stop
Trailing
Nivel de invalidaci√≥n
Comentario

Tabla clara, concisa y comparable
Ideal para seguimiento de m√∫ltiples posiciones

`;

      function showError(msg) {
        err.style.display = "block";
        err.textContent = msg;
      }
      function clearError() {
        err.style.display = "none";
        err.textContent = "";
      }

      function normalizeTicker(t) {
        return (t || "").trim().toUpperCase();
      }

      function buildPrompt() {
        const ticker = normalizeTicker(tickerEl.value);
        const estrategia = (estrategiaEl.value || "").trim();
        const riesgo = (riesgoEl.value || "").trim();

        const missing = [];
        if (!ticker) missing.push("Ticker");
        if (!estrategia) missing.push("Estrategia");
        if (!riesgo) missing.push("Perfil de riesgo");

        if (missing.length) {
          showError("Faltan campos obligatorios: " + missing.join(", ") + ".");
          btnCopy.disabled = true;
          return null;
        }

        clearError();

        const finalPrompt = template
          .replaceAll("{TICKER}", ticker)
          .replaceAll("{ESTRATEGIA}", estrategia)
          .replaceAll("{RIESGO}", riesgo);

        return finalPrompt;
      }

      async function fallbackCopyTextToClipboard(text) {
        const textarea = document.createElement("textarea");
        textarea.value = text;
        textarea.style.position = "fixed";
        textarea.style.top = "-9999px";
        document.body.appendChild(textarea);
        textarea.focus();
        textarea.select();
        try {
          document.execCommand("copy");
        } catch (e) {
          console.error("Fallo el copy fallback", e);
          throw e;
        } finally {
          document.body.removeChild(textarea);
        }
      }

      async function copyText(text) {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          return navigator.clipboard.writeText(text);
        }
        return fallbackCopyTextToClipboard(text);
      }

      btnGen.addEventListener("click", () => {
        const finalPrompt = buildPrompt();
        if (!finalPrompt) return;
        out.textContent = finalPrompt;
        btnCopy.disabled = false;
      });

      btnCopy.addEventListener("click", async () => {
        const text = out.innerText || out.textContent;
        if (!text || text.includes("Completa los 3 campos")) return;

        btnCopy.disabled = true;
        const originalText = btnCopy.textContent;

        try {
          await copyText(text);
          btnCopy.textContent = "¬°Copiado!";
        } catch (err) {
          console.error("No se pudo copiar:", err);
          btnCopy.textContent = "Error al copiar";
        } finally {
          setTimeout(() => {
            btnCopy.textContent = originalText;
            btnCopy.disabled = false;
          }, 1500);
        }
      });
    })();
  </script>
</body>
</html>
